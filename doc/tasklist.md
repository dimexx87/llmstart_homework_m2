# План разработки LLM-ассистента в Telegram

## Прогресс выполнения

| Итерация | Статус | Дата завершения | Примечания |
|----------|--------|----------------|------------|
| 1. Базовый бот | ✅ | 2025-01-09 | Создана структура проекта |
| 2. LLM интеграция | ⏳ | - | - |
| 3. История диалогов | ⏳ | - | - |
| 4. Улучшенная обработка | ⏳ | - | - |
| 5. Деплой подготовка | ⏳ | - | - |

---

## Итерация 1: Базовый Telegram-бот

**Цель**: Создать минимально работающий бот, отвечающий на команды

### Задачи
- [x] Создать `config.py` с настройками через env vars
- [x] Создать `modules/bot.py` с обработчиком `/start`
- [x] Создать `main.py` как точку входа
- [x] Добавить `requirements.txt` с `python-telegram-bot`
- [x] Создать `.env.example` и `.gitignore`

**Тест**: Бот отвечает на команду `/start` фиксированным сообщением

---

## Итерация 2: LLM интеграция

**Цель**: Подключить OpenRouter API для генерации ответов

### Задачи
- [ ] Создать `modules/llm.py` с OpenRouter клиентом
- [ ] Добавить обработку текстовых сообщений в бот
- [ ] Реализовать системный промпт как константу
- [ ] Добавить логирование запросов/ответов LLM
- [ ] Обновить `requirements.txt` с `openai`

**Тест**: Бот отвечает на любое текстовое сообщение через LLM

---

## Итерация 3: История диалогов

**Цель**: Сохранять контекст беседы в памяти

### Задачи
- [ ] Реализовать хранение истории в `dict` (user_id → messages)
- [ ] Передавать последние 20 сообщений в LLM
- [ ] Добавить команду `/clear` для очистки истории
- [ ] Улучшить логирование с контекстом пользователя

**Тест**: Бот помнит предыдущие сообщения в рамках сессии

---

## Итерация 4: Улучшенная обработка

**Цель**: Добавить обработку ошибок и лимитов

### Задачи
- [ ] Обработка ошибок API (таймауты, лимиты)
- [ ] Graceful handling недоступности LLM
- [ ] Добавить typing indicators для длинных ответов
- [ ] Лимит длины сообщений и контекста
- [ ] Команда `/help` с описанием возможностей

**Тест**: Бот корректно работает при сбоях API и показывает помощь

---

## Итерация 5: Подготовка к деплою

**Цель**: Контейнеризация и продакшн-готовность

### Задачи
- [ ] Создать `Dockerfile` для Python runtime
- [ ] Создать `docker-compose.yml` с env variables
- [ ] Добавить health checks и graceful shutdown
- [ ] Создать `Makefile` с командами разработки
- [ ] Написать базовые unit-тесты с `pytest`

**Тест**: Бот запускается и работает в Docker контейнере

---

## Примечания

- Каждая итерация должна завершаться рабочим ботом
- Следуем принципам из @conventions.md и архитектуре из @vision.md
- При возникновении проблем возвращаемся к предыдущей рабочей версии
- Тестирование выполняется вручную через Telegram
- Документация обновляется по мере необходимости
