# Соглашения по разработке кода

> Базовые принципы и технологии описаны в @vision.md

## Принципы разработки

- **KISS (Keep It Simple, Stupid)**: Простой и понятный код
- **Итеративность**: Начинаем с MVP, расширяем постепенно
- **Без преждевременной оптимизации**: Оптимизируем только по необходимости

## Технологический стек

- **Python** как основной язык
- **python-telegram-bot** для Telegram API
- **OpenRouter** через `openai` клиент для LLM
- **uv** для управления зависимостями

## Структура кода

Следуем архитектуре из @vision.md:
- `main.py` — точка входа
- `config.py` — конфигурация через env vars
- `modules/bot.py` — логика Telegram-бота
- `modules/llm.py` — взаимодействие с LLM

## Конфигурация

- Все настройки через **переменные окружения**
- Секреты: `TELEGRAM_BOT_TOKEN`, `OPENROUTER_API_KEY`
- Локально: `.env` файл (в `.gitignore`)

## Логирование

Используем стандартный `logging`:
- `INFO` — основные события
- `DEBUG` — детали (запросы/ответы LLM)
- `ERROR` — ошибки и исключения
- Вывод в stdout для совместимости с Docker

## Обработка данных

- История диалогов в памяти (`dict` с user_id → list сообщений)
- Контекст LLM: системный промпт + 20 последних сообщений
- Системный промпт как константа в коде

## Качество кода

- Простые функции без оверинжиниринга
- Минимальное тестирование через `pytest`
- Логирование всех запросов/ответов LLM для мониторинга
- Честная обработка ошибок и ограничений

## Docker

- Простой `Dockerfile` с Python runtime
- `docker-compose` для управления
- Переменные окружения в контейнер
